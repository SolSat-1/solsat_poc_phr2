# Enhanced Solar Report JSON Metadata Description

## Overview

This document provides detailed descriptions of each metadata field in the enhanced solar analysis JSON report generated by the `EnhancedSolarReportGenerator`. The report follows a structured format that includes comprehensive solar analysis data, economic calculations, and quality assessments.

## Report Structure

### Root Level Fields

#### `total_rooftops` (integer)
**Description**: Total number of rooftops analyzed in this report.
**Example**: `3`
**Usage**: Used for summary statistics and batch processing validation.

#### `analysis_config` (object)
**Description**: Configuration parameters used for the analysis.
**Fields**:
- `gee_available` (boolean): Whether Google Earth Engine is available for satellite data
- `prefer_gee_data` (boolean): Whether to prefer satellite data over calculated values
- `monthly_consumption_kwh` (number): Default monthly electricity consumption in kWh
- `thailand_optimized` (boolean): Whether Thailand-specific parameters are used
- `scientific_algorithms` (object): Scientific methods employed in calculations

#### `rooftop_analyses` (array)
**Description**: Array containing detailed analysis for each individual rooftop.
**Structure**: Each element contains complete analysis data for one rooftop.

#### `summary_statistics` (object)
**Description**: Aggregated statistics across all analyzed rooftops.
**Usage**: Provides overview metrics for portfolio-level analysis.

#### `metadata` (object)
**Description**: Technical metadata about the report generation process.
**Usage**: Quality assurance, reproducibility, and method documentation.

---

## Individual Rooftop Analysis Structure

### `roof_analysis` (object)
**Description**: Physical characteristics of the rooftop.

#### `area_m2` (number)
**Description**: Calculated rooftop area in square meters using the Shoelace formula.
**Calculation Method**: Shoelace formula with geographic coordinate conversion.
**Accuracy**: ±5% for small polygons.
**Example**: `1166.804435691964`

#### `coordinates` (array)
**Description**: Geographic coordinates defining the rooftop polygon.
**Format**: Array of [longitude, latitude] pairs in decimal degrees.
**Coordinate System**: WGS84 (EPSG:4326).
**Example**: `[[100.540148, 13.671842], [100.540164, 13.671602], ...]`

### `solar_irradiance` (object)
**Description**: Solar irradiance calculations using scientific algorithms.

#### `ghi` (number)
**Description**: Global Horizontal Irradiance in W/m².
**Calculation**: Ineichen-Perez clear sky model or ERA5 satellite data.
**Scientific Basis**: Accounts for atmospheric absorption, scattering, and local conditions.
**Example**: `92.551241990349`

#### `dni` (number)
**Description**: Direct Normal Irradiance in W/m².
**Calculation**: Derived from GHI using atmospheric models.
**Usage**: Critical for tracking solar systems and concentrated solar power.
**Example**: `78.66855569179664`

#### `elevation_angle` (number)
**Description**: Solar elevation angle in degrees at analysis time.
**Calculation**: Michalsky algorithm for precise solar position.
**Range**: 0° (horizon) to 90° (zenith).
**Example**: `0.7157802088291181`

#### `air_mass` (number)
**Description**: Atmospheric air mass using Kasten-Young formula.
**Scientific Basis**: More accurate than simple secant formula for large zenith angles.
**Usage**: Critical for atmospheric absorption calculations.
**Example**: `29.008238546692713`

#### `seasonal_factor` (number)
**Description**: Seasonal variation factor for Thailand's tropical climate.
**Calculation**: Cosine function based on day of year, accounting for Earth-Sun distance.
**Range**: Typically 0.9 to 1.1 for Thailand.
**Example**: `1.0292600335633348`

#### `data_source` (string)
**Description**: Source of irradiance data.
**Values**: 
- `"Enhanced_Calculation"`: Scientific clear sky models
- `"GEE_ERA5_adaptive_buffering"`: Satellite data with adaptive buffering
- `"Fallback_Calculation"`: Basic estimation methods

### `panel_optimization` (object)
**Description**: Optimal solar panel configuration for the rooftop.

#### `roof_area` (number)
**Description**: Total rooftop area in m² (same as roof_analysis.area_m2).
**Usage**: Reference for coverage calculations.

#### `usable_area` (number)
**Description**: Area available for panel installation after accounting for constraints.
**Calculation**: `roof_area × usable_area_factor (0.75)`
**Constraints**: Walkways, HVAC equipment, structural limitations, setbacks.
**Example**: `875.103326768973`

#### `panel_count` (integer)
**Description**: Optimal number of solar panels that can be installed.
**Calculation**: `floor(usable_area / panel_area_m2)`
**Panel Specifications**: 400W panels, 2.23 m² each.
**Example**: `392`

#### `total_power_kw` (number)
**Description**: Total system power capacity in kilowatts.
**Calculation**: `panel_count × panel_power_rating / 1000`
**Example**: `156.8`

#### `coverage_ratio` (number)
**Description**: Fraction of total roof area covered by panels.
**Calculation**: `(panel_count × panel_area) / roof_area`
**Range**: 0.0 to 1.0 (typically 0.6-0.8 for optimal designs).
**Example**: `0.7491915296684541`

#### `panel_specifications` (object)
**Description**: Technical specifications of solar panels used.
- `power_rating_w`: 400W per panel
- `area_m2`: 2.23 m² per panel
- `efficiency`: 0.17 (17% conversion efficiency)

### `energy_production` (object)
**Description**: Energy production estimates using system modeling.

#### `daily_energy_kwh` (number)
**Description**: Daily energy production in kWh.
**Calculation**: `total_power_kw × peak_sun_hours × system_efficiency × temperature_factor × inverter_efficiency`
**Peak Sun Hours**: 5.0 hours (typical for Thailand).
**Example**: `121.55135999999999`

#### `monthly_energy_kwh` (number)
**Description**: Monthly energy production in kWh.
**Calculation**: `daily_energy_kwh × 30.44` (average days per month).
**Example**: `3700.0233983999997`

#### `yearly_energy_kwh` (number)
**Description**: Annual energy production in kWh.
**Calculation**: `daily_energy_kwh × 365`
**Usage**: Primary metric for economic analysis.
**Example**: `44366.246399999996`

#### `system_efficiency` (number)
**Description**: Overall system efficiency factor.
**Value**: 0.17 (17% - includes panel efficiency and system losses).
**Components**: Panel efficiency, wiring losses, inverter losses.

#### `temperature_factor` (number)
**Description**: Temperature derating factor for Thailand's climate.
**Value**: 0.95 (5% loss due to high ambient temperatures).
**Scientific Basis**: Solar panels lose efficiency at high temperatures.

#### `inverter_efficiency` (number)
**Description**: DC to AC conversion efficiency.
**Value**: 0.96 (96% - typical for modern inverters).

#### `peak_sun_hours` (number)
**Description**: Equivalent hours of peak solar irradiance (1000 W/m²).
**Value**: 5.0 hours (typical for Thailand's latitude).
**Usage**: Standard metric for solar resource assessment.

#### `performance_factors` (object)
**Description**: Detailed performance factors affecting energy production.
- `irradiance_factor`: Normalized irradiance relative to standard conditions
- `temperature_factor`: Temperature derating
- `system_factor`: Combined system efficiency

### `economic_analysis` (object)
**Description**: Comprehensive financial analysis using Thailand market parameters.

#### `total_system_cost` (number)
**Description**: Total installed system cost in Thai Baht (THB).
**Calculation**: `equipment_cost + installation_cost`
**Example**: `14112000.0`

#### `equipment_cost` (number)
**Description**: Cost of solar panels and equipment in THB.
**Calculation**: `total_power_kw × 1000 × panel_cost_per_watt (30 THB/W)`
**Example**: `4704000.0`

#### `installation_cost` (number)
**Description**: Installation and labor costs in THB.
**Calculation**: `equipment_cost × installation_cost_multiplier (2.0)`
**Rationale**: Installation typically costs 2x equipment cost in Thailand.
**Example**: `9408000.0`

#### `annual_energy_value` (number)
**Description**: Annual value of energy production in THB.
**Calculation**: `yearly_energy_kwh × electricity_rate_thb_per_kwh (4.5)`
**Example**: `199648.1088`

#### `annual_maintenance` (number)
**Description**: Annual maintenance costs in THB.
**Calculation**: `total_system_cost × maintenance_rate_annual (0.01)`
**Rationale**: 1% of system cost per year for maintenance.
**Example**: `141120.0`

#### `net_annual_savings` (number)
**Description**: Net annual savings after maintenance costs in THB.
**Calculation**: `annual_energy_value - annual_maintenance`
**Example**: `58528.10879999999`

#### `monthly_energy_value` (number)
**Description**: Monthly value of energy production in THB.
**Calculation**: `monthly_energy_kwh × electricity_rate_thb_per_kwh`
**Example**: `16650.1052928`

#### `monthly_bill_reduction` (number)
**Description**: Estimated monthly electricity bill reduction in THB.
**Calculation**: `monthly_energy_value × 0.8` (80% self-consumption assumption).
**Example**: `13320.08423424`

#### `payback_years` (number)
**Description**: Simple payback period in years.
**Calculation**: `total_system_cost / net_annual_savings`
**Interpretation**: Time to recover initial investment.
**Example**: `241.11491536866475`

#### `roi_percentage` (number)
**Description**: Annual return on investment as percentage.
**Calculation**: `(net_annual_savings / total_system_cost) × 100`
**Example**: `0.4147399999999999`

#### `financial_assumptions` (object)
**Description**: Economic parameters used in calculations.
- `electricity_rate_thb_kwh`: 4.5 THB per kWh
- `maintenance_rate`: 1% annually
- `system_lifetime_years`: 25 years
- `discount_rate`: 5% for NPV calculations

### `solar_potential_score` (number)
**Description**: Composite score (0-100) rating overall solar potential.
**Calculation Components**:
- Energy production potential (40%)
- Economic viability (30%)
- Technical feasibility (20%)
- Data quality (10%)
**Interpretation**:
- 80-100: Excellent potential
- 60-79: Good potential
- 40-59: Moderate potential
- 0-39: Poor potential
**Example**: `27.59752339980698`

### `recommended_color_palette` (array)
**Description**: Color codes for visualization based on solar potential score.
**Format**: Array of hex color codes [primary, secondary].
**Color Mapping**:
- Green (`#00FF00`): Excellent (80-100)
- Yellow (`#FFFF00`): Good (60-79)
- Orange (`#FF8C00`): Moderate (40-59)
- Red (`#FF0000`): Poor (0-39)
**Example**: `["#FF0000", "#FFFFFF"]`

### `data_source` (string)
**Description**: Primary data source used for this rooftop analysis.
**Values**:
- `"Enhanced_Calculation"`: Scientific clear sky models
- `"GEE_ERA5_Enhanced"`: Satellite data with enhancements
- `"Mock_Calculation"`: Fallback estimation

### `enhanced_features` (object)
**Description**: Advanced features and metadata for this analysis.

#### `gee_integration` (boolean)
**Description**: Whether Google Earth Engine integration is enabled.

#### `data_preference` (string)
**Description**: Preferred data source for this analysis.
**Values**: `"Satellite"`, `"Enhanced"`, `"Mock"`

#### `analysis_timestamp` (string)
**Description**: ISO 8601 timestamp when analysis was performed.
**Format**: `YYYY-MM-DDTHH:MM:SS.ssssss`
**Example**: `"2025-09-03T22:12:53.213250"`

#### `scientific_validity` (string)
**Description**: Assessment of scientific validity of the analysis.
**Values**: `"High"`, `"Medium"`, `"Low"`
**Criteria**: Based on data sources and calculation methods used.

#### `adaptive_buffering_used` (boolean)
**Description**: Whether adaptive buffering was used for small polygon handling.
**Relevance**: Important for ERA5 satellite data retrieval quality.

---

## Summary Statistics Structure

### `total_roof_area_m2` (number)
**Description**: Sum of all analyzed rooftop areas in square meters.
**Calculation**: Sum of individual roof_analysis.area_m2 values.

### `total_recommended_panels` (integer)
**Description**: Total number of panels recommended across all rooftops.
**Calculation**: Sum of individual panel_optimization.panel_count values.

### `total_system_power_kw` (number)
**Description**: Total system capacity across all rooftops in kW.
**Calculation**: Sum of individual panel_optimization.total_power_kw values.

### `total_yearly_energy_kwh` (number)
**Description**: Total annual energy production across all rooftops in kWh.
**Calculation**: Sum of individual energy_production.yearly_energy_kwh values.

### `total_monthly_savings_thb` (number)
**Description**: Total monthly electricity bill savings across all rooftops in THB.
**Calculation**: Sum of individual economic_analysis.monthly_bill_reduction values.

### `average_solar_score` (number)
**Description**: Mean solar potential score across all rooftops.
**Calculation**: Mean of individual solar_potential_score values.

### `solar_score_std` (number)
**Description**: Standard deviation of solar potential scores.
**Usage**: Indicates variability in solar potential across the portfolio.

### `data_source_distribution` (object)
**Description**: Count of rooftops by primary data source used.
**Example**: `{"GEE_ERA5": 0, "Enhanced_Calculation": 3}`

### `gee_data_usage_percentage` (number)
**Description**: Percentage of rooftops analyzed using satellite data.
**Calculation**: `(GEE_ERA5_count / total_rooftops) × 100`

### `analysis_quality` (object)
**Description**: Distribution of analyses by quality level.
**Categories**:
- `high_quality_analyses`: Solar score ≥ 70
- `medium_quality_analyses`: Solar score 40-69
- `low_quality_analyses`: Solar score < 40

---

## Metadata Structure

### `report_generated` (string)
**Description**: ISO 8601 timestamp when the report was generated.
**Usage**: Version control and audit trail.

### `generator_version` (string)
**Description**: Version of the report generator software.
**Example**: `"2.0.0"`

### `scientific_methods` (object)
**Description**: Scientific algorithms and methods used in calculations.
**Fields**:
- `solar_position_algorithm`: Michalsky (1988) algorithm
- `clear_sky_model`: Ineichen-Perez (2002) model
- `air_mass_formula`: Kasten-Young (1989) formula
- `adaptive_buffering`: ERA5 small polygon best practices
- `area_calculation`: Shoelace formula with coordinate conversion

### `data_sources` (object)
**Description**: Data sources used in the analysis.
**Fields**:
- `satellite_data`: ERA5 Land Daily Aggregated (ECMWF)
- `atmospheric_parameters`: Thailand-optimized tropical climate
- `economic_parameters`: Thailand electricity market 2025

### `quality_assurance` (object)
**Description**: Quality assurance measures and accuracy estimates.
**Fields**:
- `coordinate_validation`: Input validation performed
- `area_calculation_accuracy`: ±5% accuracy estimate
- `irradiance_model_accuracy`: ±10% under clear sky conditions
- `economic_assumptions`: Conservative estimates used

---

## Usage Guidelines

### For Developers
1. **Validation**: Always validate required fields before processing
2. **Error Handling**: Check for null/missing values in critical fields
3. **Units**: Pay attention to units (m², kW, kWh, THB, degrees, etc.)
4. **Precision**: Be aware of floating-point precision in calculations

### For Analysts
1. **Quality Assessment**: Use `solar_potential_score` and `analysis_quality` for filtering
2. **Data Source Awareness**: Consider `data_source` when interpreting results
3. **Uncertainty**: Account for accuracy estimates in `quality_assurance`
4. **Temporal Context**: Note `analysis_timestamp` for time-sensitive analyses

### For Visualization
1. **Color Coding**: Use `recommended_color_palette` for consistent visualization
2. **Coordinate System**: Coordinates are in WGS84 decimal degrees
3. **Scaling**: Use `coverage_ratio` for proportional representations
4. **Grouping**: Use `solar_potential_score` ranges for categorization

---

## Scientific References

1. **Michalsky, J.J. (1988)**: "The Astronomical Almanac's algorithm for approximate solar position (1950-2050)." Solar Energy 40(3):227-235.

2. **Ineichen, P. and Perez, R. (2002)**: "A new airmass independent formulation for the Linke turbidity coefficient." Solar Energy 73(3):151-157.

3. **Kasten, F. and Young, A.T. (1989)**: "Revised optical air mass tables and approximation formula." Applied Optics 28(22):4735-4738.

4. **ECMWF (2019)**: "ERA5-Land: a state-of-the-art global reanalysis dataset for land applications." Earth System Science Data 11(4):1755-1785.

---

## Version History

- **v2.0.0**: Enhanced report generator with adaptive buffering and scientific algorithms
- **v1.0.0**: Basic report generator with mock calculations

---

*This documentation is automatically generated and maintained as part of the Enhanced Solar Analysis System.*
